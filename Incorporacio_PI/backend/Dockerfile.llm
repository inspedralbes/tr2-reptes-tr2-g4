# Fem servir Alpine Linux (molt més lleuger i ràpid de descarregar)
FROM alpine:latest

# 1. Instal·lem eines de compilació (apk és molt més ràpid que apt-get)
RUN apk add --no-cache build-base git cmake linux-headers curl-dev

WORKDIR /app

# 2. Clonem i compilem llama.cpp (versió lleugera)
RUN git clone --depth 1 https://github.com/ggerganov/llama.cpp.git .
RUN cmake -B build -DGGML_BACKTRACE=OFF
RUN cmake --build build --config Release --target llama-server -j4
RUN cp build/bin/llama-server .

# 3. Preparem l'execució
EXPOSE 8080
ENTRYPOINT ["./llama-server"]